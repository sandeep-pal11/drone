{% include "header.html" %}

    <main class="main__content_wrapper">
        <!-- Start breadcrumb section -->
<section class="breadcrumb__section breadcrumb__bg">
    <div class="container">
        <div class="row row-cols-1">
            <div class="col">
                <div class="breadcrumb__content">
                    <h1 class="breadcrumb__content--title mb-10">Product Details</h1>
                    <ul class="breadcrumb__content--menu d-flex">
                        <li class="breadcrumb__content--menu__items"><a href="/">Home</a></li>
                        <li class="breadcrumb__content--menu__items"><span class="text__secondary">Product Details</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End breadcrumb section -->

<!-- Start product details section -->
<section class="product__details--section section--padding">
    <div class="container">
        <div class="row row-cols-lg-2 row-cols-md-2 row-cols-1">
            <div class="col">
                <div class="product__details--media d-flex">
                    <div class="product__media--nav swiper">
                        <div class="swiper-wrapper">
                            <!-- Assuming you want to add both primary and secondary images dynamically -->
                            <div class="swiper-slide">
                                <img src="/media/{{ product.image }}" alt="product-primary-image" />
                            </div>
                            <div class="swiper-slide">
                                <img src="/media/{{ product.image_secondary }}" alt="product-secondary-image" />
                            </div>
                        </div>
                    </div>
                    <div class="product__media--right">
                        <div class="product__media--preview swiper">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <div class="product__media--preview__items">
                                        <a class="product__media--preview__items--link glightbox" data-gallery="product-media-preview" href="/media/{{ product.image }}">
                                            <img class="product__media--preview__items--img" src="/media/{{ product.image }}" alt="product-primary-img" />
                                        </a>
                                        <div class="product__media--view__icon">
                                            <a class="product__media--view__icon--link glightbox" href="/media/{{ product.image }}" data-gallery="product-media-preview">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                                                    <image width="18" height="18" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAVhJREFUOE/llLtKA0EUhjdY+BD6ABaW3tIYTWEhiKKCCGIgqGhCgqXvoQFRQdBGERQvUaJFgilVRHwF8RWCWqzfD7OyjrPZ7R342HP2nP1n58yZSfm+/+F53ivUoAseoALtxirBIXiHLPSlEHrBaMGyEYzR+BXuwduHTgltYNzBKSxAM6HSAHknMAf9EqpjjEIGzmAK7mPE0sSrRkQ/cSWhIkZQE4kdwzxoAteQiCbMgeqqsSIhO3nEJK7xPLKC0/h7oT/5CbuEFByDCShDeKZNfC3lwp49SihiVdGv/6GQdm4WSlaxt/AvQ9vedteCZlsn68Aqr/pLPfenaVVsHcBt80HQbIv4txF75GravIQafKClDMKNq9kcgspXd0+CjlM1OLTXZu1LPNVwScYwSYcwA2kJPWJ8QQGekyiEcnqxd6BDQp8YupPOoRueYDdGME9c18gbjMv+BiJYeHc6xpjnAAAAAElFTkSuQmCC"/>
                                                </svg>                                                              
                                                <span class="visually-hidden">Media Gallery</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="swiper-slide">
                                    <div class="product__media--preview__items">
                                        <a class="product__media--preview__items--link glightbox" data-gallery="product-media-preview" href="/media/{{ product.image_secondary }}">
                                            <img class="product__media--preview__items--img" src="/media/{{ product.image_secondary }}" alt="product-secondary-img" />
                                        </a>
                                        <div class="product__media--view__icon">
                                            <a class="product__media--view__icon--link glightbox" href="/media/{{ product.image_secondary }}" data-gallery="product-media-preview">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                                                    <image width="18" height="18" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAABHNCSVQICAgIfAhkiAAAAVhJREFUOE/llLtKA0EUhjdY+BD6ABaW3tIYTWEhiKKCCGIgqGhCgqXvoQFRQdBGERQvUaJFgilVRHwF8RWCWqzfD7OyjrPZ7R342HP2nP1n58yZSfm+/+F53ivUoAseoALtxirBIXiHLPSlEHrBaMGyEYzR+BXuwduHTgltYNzBKSxAM6HSAHknMAf9EqpjjEIGzmAK7mPE0sSrRkQ/cSWhIkZQE4kdwzxoAteQiCbMgeqqsSIhO3nEJK7xPLKC0/h7oT/5CbuEFByDCShDeKZNfC3lwp49SihiVdGv/6GQdm4WSlaxt/AvQ9vedteCZlsn68Aqr/pLPfenaVVsHcBt80HQbIv4txF75GravIQafKClDMKNq9kcgspXd0+CjlM1OLTXZu1LPNVwScYwSYcwA2kJPWJ8QQGekyiEcnqxd6BDQp8YupPOoRueYDdGME9c18gbjMv+BiJYeHc6xpjnAAAAAElFTkSuQmCC"/>
                                                </svg>
                                                <span class="visually-hidden">Media Gallery</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>   
            <div class="col">
                <div class="product__details--info">
                    <form action="#">
                        <h3 class="product__details--info__title mb-15">{{ product.name }}</h3>
                        <div class="product__details--info__rating d-flex align-items-center mb-15">
                            <ul class="rating product__list--rating d-flex">
                                <li class="rating__list">
                                    <span class="rating__list--icon">
                                        <svg class="rating__list--icon__svg" xmlns="http://www.w3.org/2000/svg" width="13.105" height="13.732" viewBox="0 0 10.105 9.732">
                                        <path d="M9.837,3.5,6.73,3.039,5.338.179a.335.335,0,0,0-.571,0L3.375,3.039.268,3.5a.3.3,0,0,0-.178.514L2.347,6.242,1.813,9.4a.314.314,0,0,0,.464.316L5.052,8.232,7.827,9.712A.314.314,0,0,0,8.292,9.4L7.758,6.242l2.257-2.231A.3.3,0,0,0,9.837,3.5Z" fill="currentColor"></path>
                                        </svg>
                                    </span>
                                </li>
                                <!-- Repeat the above block for other stars in the rating if necessary -->
                                <li class="rating__list"><span class="rating__list--text text__secondary">( 5.0)</span></li>
                            </ul>
                        </div>
                        <div class="product__details--info__price mb-10">
                            <span class="current__price">${{ product.price }}</span>
                            {% if product.is_on_sale %}
                            <span class="old__price">${{ product.price|add:"100" }}</span> <!-- Assuming a discount of 100 -->
                            {% endif %}
                        </div> 
                        <p class="product__details--info__desc mb-15">{{ product.description }}</p>
                        <div class="product__variant--list quantity d-flex align-items-center mb-20">
                            <div class="quantity__box">
                                <button type="button" class="quantity__value quickview__value--quantity decrease" aria-label="quantity value" value="Decrease Value">-</button>
                                <label>
                                    <input type="number" class="quantity__number quickview__value--number" value="1" data-counter />
                                </label>
                                <button type="button" class="quantity__value quickview__value--quantity increase" aria-label="quantity value" value="Increase Value">+</button>
                            </div>
                            <button class="quickview__cart--btn primary__btn cart" type="submit">Add To Cart</button>  
                        </div>
            
                        <div class="product__variant--list mb-15">
                            <button class="variant__buy--now__btn primary__btn" type="submit">Buy it now</button>
                        </div>
                    </div>
                </section>
                <!-- End product details section -->
            
                <!-- Cart Count -->
                <div>
                    <span id="cart">0</span> Items in Cart
                </div>
            
                <!-- Footer -->
                {% include "footer.html" %}
            
                <!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Load or Initialize Cart
    let cart = localStorage.getItem('cart') ? JSON.parse(localStorage.getItem('cart')) : {};

    // Update Cart Count on Page Load
    function updateCartCount() {
        let total = 0;
        for (let key in cart) {
            total += cart[key].quantity;
        }
        document.getElementById("cart").textContent = total;
    }
    updateCartCount();

    // Quantity Increase
    $('.increase').click(function () {
        let input = $(this).siblings('label').find('input');
        let value = parseInt(input.val());
        input.val(value + 1);
    });

    // Quantity Decrease
    $('.decrease').click(function () {
        let input = $(this).siblings('label').find('input');
        let value = parseInt(input.val());
        if (value > 1) input.val(value - 1);
    });

    // Add to Cart
    $('.cart').click(function (e) {
        e.preventDefault();

        const id = '{{ product.id }}';
        const name = '{{ product.name }}';
        const price = parseFloat("{{ product.price|floatformat:2 }}");  // âœ… Safe price parsing
        const image = '/media/{{ product.image }}';
        const qty = parseInt($('.quantity__number').val());

        if (isNaN(price)) {
            alert("Price is invalid.");
            return;
        }

        if (cart[id] !== undefined) {
            cart[id].quantity += qty;
        } else {
            cart[id] = {
                id: id,
                name: name,
                price: price,
                image: image,
                quantity: qty
            };
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();

        console.log("Cart Updated:", cart);
        alert(`${name} added to cart!`);
    });
</script>
